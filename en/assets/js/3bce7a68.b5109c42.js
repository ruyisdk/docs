"use strict";(self.webpackChunkruyisdk=self.webpackChunkruyisdk||[]).push([[7010],{12251:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>a,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var i=t(74848),s=t(28453);const r={sidebar_position:7},o="Building the milkv-duo-examples Sample Program",c={id:"Package-Manager/cases/case7",title:"Building the milkv-duo-examples Sample Program",description:"First, install the necessary dependencies:",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/Package-Manager/cases/case7.md",sourceDirName:"Package-Manager/cases",slug:"/Package-Manager/cases/case7",permalink:"/docs/en/docs/Package-Manager/cases/case7",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Using QEMU and LLVM",permalink:"/docs/en/docs/Package-Manager/cases/case6"},next:{title:"More Information",permalink:"/docs/en/docs/Package-Manager/misc"}},a={},l=[];function d(n){const e={code:"code",h1:"h1",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"building-the-milkv-duo-examples-sample-program",children:"Building the milkv-duo-examples Sample Program"}),"\n",(0,i.jsx)(e.p,{children:"First, install the necessary dependencies:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"$ ruyi install gnu-milkv-milkv-duo-musl-bin\n"})}),"\n",(0,i.jsxs)(e.p,{children:["Extract and build ",(0,i.jsx)(e.code,{children:"milkv-duo-examples"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"$ mkdir test-duo-examples\n$ cd test-duo-examples\n$ ruyi extract milkv-duo-examples\n"})}),"\n",(0,i.jsxs)(e.p,{children:["Modify the contents of ",(0,i.jsx)(e.code,{children:"envsetup.sh"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n\nscript_dir=$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" &> /dev/null && pwd)\necho "script_dir: ${script_dir}"\n\nmilkv_debug=0\n\nmilkv_chip=\nmilkv_arch=\n\nhost_tools_pkg="gnu-milkv-milkv-duo-musl-bin"\nhost_tools=${script_dir}/host-tools/ruyi-venv\n\nfunction print_info()    { printf "\\e[1;92m%s\\e[0m\\n" "$1"; }\nfunction print_warning() { printf "\\e[1;93m%s\\e[0m\\n" "$1"; }\nfunction print_note()    { printf "\\e[1;94m%s\\e[0m\\n" "$1"; }\nfunction print_err()     { printf "\\e[1;31mError: %s\\e[0m\\n" "$1"; }\n\nfunction choose_target() {\n\techo "Select Product:"\n\tprint_info "1. Duo (CV1800B)"\n\tprint_info "2. Duo256M (SG2002) or DuoS (SG2000)"\n\tread -p "Which would you like: " chip_index\n\n\tif [ "${chip_index}" -eq 1 ]; then\n\t\tmilkv_chip="CV180X"\n\t\tmilkv_arch="riscv64"\n\telif [ "${chip_index}" -eq 2 ]; then\n\t\tmilkv_chip="CV181X"\n\t\tmilkv_arch="riscv64"\n\telse\n\t\tprint_err "Nothing selected for Chip."\n\t\treturn 1\n\tfi\n\n\tprint_note "CHIP: ${milkv_chip}"\n\tprint_note "ARCH: ${milkv_arch}"\n}\n\nfunction check_host_tools() {\n\tif [ ! -d ${host_tools} ]; then\n\t\tprint_warning "host-tools does not exist, download it now..."\n\t\truyi install ${host_tools_pkg}\n\t\tmkdir -p $(dirname ${host_tools})\n\t\truyi venv -t ${host_tools_pkg} milkv-duo ${host_tools}\n\t\tif [ $? -ne 0 ]; then\n\t\t\tprint_err "Get the host-tools pkg failed!"\n\t\t\treturn 1\n\t\tfi\n\telse\n\t\tif [ ! -e ${host_tools}/bin/ruyi-activate ]; then\n\t\t\tprint_warning "Ruyi Virtual Environment broken!"\n\t\t\tprint_warning "Please manually delete it first. [ ${host_tools} ]"\n\t\t\tprint_warning "Then source the script again."\n\t\t\treturn 2\n\t\tfi\n\tfi\n}\n\nchoose_target\n[[ "${?}" -eq 0 ]] || return 1\n\npushd ${script_dir}\ncheck_host_tools\n[[ "${?}" -eq 0 ]] || {\n\tpopd\n\treturn 1\n}\npopd\n\nsys_inc="${script_dir}/include/system"\n\nif [[ "${milkv_arch}" == "riscv64" ]]; then\n\n\tarch_cflags="-mcpu=c906fdv -march=rv64imafdcv0p7xthead -mcmodel=medany -mabi=lp64d"\n\tarch_ldflags="-D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64"\n\n\texport TOOLCHAIN_PREFIX=riscv64-unknown-linux-musl-\n\nelse\n\tprint_err "Invalid ARCH parameter!"\n\treturn 1\nfi\n\nif [[ "${milkv_chip}" == "CV180X" ]]; then\n\tsys_lib="${script_dir}/libs/system/musl_riscv64"\nelif [[ "${milkv_chip}" == "CV181X" ]]; then\n\tsys_lib="${script_dir}/libs/system/musl_riscv64"\nelse\n\tprint_err "Invalid CHIP parameter!"\n\treturn 1\nfi\n\nif [ "${milkv_debug}" -eq 1 ]; then\n\tdebug_cflags="-g -O0"\nelse\n\tdebug_cflags="-O3 -DNDEBUG"\nfi\n\nexport CC="${TOOLCHAIN_PREFIX}gcc"\nexport CFLAGS="${arch_cflags} ${debug_cflags} -I${sys_inc}"\nexport LDFLAGS="${arch_ldflags} -L${sys_lib}"\n\nexport CHIP="${milkv_chip}"\n\nsource ${host_tools}/bin/ruyi-activate\n\nprint_info "Environment is ready."\n'})}),"\n",(0,i.jsx)(e.p,{children:"Activate the virtual environment:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"$ source envsetup.sh\n"})}),"\n",(0,i.jsx)(e.p,{children:"You should now be able to build successfully:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-shell",children:"$ cd i2c/ssd1306_i2c\n$ make\n"})})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>o,x:()=>c});var i=t(96540);const s={},r=i.createContext(s);function o(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);